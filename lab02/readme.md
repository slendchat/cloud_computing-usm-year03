# Лабораторная работа №2. Введение в AWS. Вычислительные сервисы

## Цель работы
Познакомиться с основными вычислительными сервисами AWS, научиться создавать и настраивать виртуальные машины EC2 и развёртывать простые PHP-приложения.

## Постановка задачи
- зарегистрироваться в AWS и работать в регионе `eu-central-1`;
- создать IAM-группу и пользователя с правами администратора;
- настроить бюджет Zero Spend;
- запустить экземпляр Amazon EC2 и подготовить его с помощью User Data;
- проверить мониторинг и журнал системы;
- подключиться к инстансу по SSH с использованием ключей;
- развернуть собственный сайт на PHP и настроить Nginx + PHP-FPM;
- остановить инстанс через AWS CLI и подготовить отчёт.

## Артефакты репозитория
- Исходный код сайта: `lab02/public`.
- Конфигурация nginx: `lab02/nginx_mywebsite.conf`.
- Скриншоты выполнения лабораторной: `lab02/img`.
- Итоговый отчёт: `lab02/readme.md`.

## Ход выполнения

### Задание 0. Подготовка среды
- Зарегистрировался в AWS и убедился, что активен бесплатный уровень.
- Авторизовался в консоли от имени root-пользователя и переключил регион на `EU (Frankfurt) eu-central-1`.

### Задание 1. Создание IAM группы и пользователя
- В сервисе IAM создал группу `Admins` и прикрепил политику `AdministratorAccess`.
- Создал пользователя `cloudstudent`, добавил его в группу `Admins` и разрешил вход в консоль.
- Выполнил первый вход под новым IAM-пользователем, убедившись, что доступ сохранён.

### Задание 2. Настройка Zero-Spend Budget
- В Billing and Cost Management создал бюджет типа Zero Spend с именем `ZeroSpend`.
- Указал свой e-mail для уведомлений, чтобы получать письма при любых расходах.

### Задание 3. Создание и запуск EC2 экземпляра
- Через EC2 запустил инстанс `webserver` на базе Amazon Linux 2023 AMI, тип `t3.micro`.
- Создал новую пару ключей `arthur-keypair.pem` и скачал её для SSH.
- Настроил Security Group `webserver-sg`: разрешил HTTP с любого адреса и SSH только со своего IP.
- В секции User Data добавил скрипт установки и запуска Nginx и вспомогательных пакетов.
- После запуска проверил статус инстанса и убедился, что публичный IP отвечает по HTTP.

![Скриншот консоли инстанса перед настройкой сайта](img/before_moving_website.png)

### Задание 4. Логирование и мониторинг
- На вкладке Status checks убедился, что обе проверки (system и instance reachability) прошли успешно (2/2).
- Просмотрел базовые метрики CloudWatch на вкладке Monitoring.
- Получил системный лог и нашёл в нём вывод cloud-init с установкой Nginx.
- Снял скриншот консоли инстанса через пункт Get instance screenshot.

![Скриншот монитора инстанса](img/instance_screenshot.png)

### Задание 5. Подключение к EC2 инстансу по SSH
- Настроил права на ключ `.pem` согласно требованиям AWS.

![Настройка прав на приватный ключ](img/pem_file_permissions.png)

- Подключился к инстансу по SSH с помощью `ssh -i arthur-keypair.pem ec2-user@<Public-IP>`.

![Успешное SSH-подключение](img/ssh_connect.png)

- Проверил состояние сервиса Nginx.

![Проверка статуса nginx](img/nginx_status.png)

### Задание 6b. Развёртывание веб-сайта на PHP
- Подготовил локально простое PHP-приложение из трёх страниц: `index.php` (галерея), `facts.php` (факты), `care.php` (советы). Код лежит в `lab02/public`.
- Перенёс файлы сайта на сервер через `scp`, попутно задокументировал процесс.

![Перенос файлов сайта на сервер](img/moving_website.png)

- Создал конфигурацию `nginx_mywebsite.conf` и загрузил её на сервер. На первом запуске нашёл и исправил опечатку в конфигурации.

![Передача конфигурации nginx](img/sending_nginx_conf.png)
![Сообщение об ошибке проверки конфигурации](img/nginx_conf_error.png)
![Исправление конфигурации и повторная проверка](img/nginx_conf_fix.png)
![Финальный успешный результат проверки](img/nginx_conf_fixed.png)

- Перезапустил Nginx и убедился, что PHP-FPM работает корректно.

![Статус служб nginx и php-fpm](img/nginx_php-fpm_status.png)

- Открыл сайт по публичному IP и убедился, что отдается обновлённая версия.

![Работающий сайт на EC2](img/website_working.png)

### Задание 7. Завершение работы и удаление ресурсов
- Через AWS CLI выполнил команду остановки инстанса, чтобы прекратить начисление платы за вычислительные ресурсы.

![Остановка инстанса через AWS CLI](img/instance_stop_awsCLI.png)

## Контрольные вопросы
- Политика `AdministratorAccess` предоставляет полные права на все ресурсы и сервисы AWS; она используется для административных пользователей и должна выдаваться ограниченному числу людей.
- User Data — это скрипт, который выполняется при запуске инстанса и автоматизирует начальную настройку. В моём случае скрипт устанавливает пакеты, включая Nginx, и запускает веб-сервер. Nginx нужен для обработки HTTP-запросов и проксирования их в PHP-FPM.
- Детализированный мониторинг (1-минутные метрики) стоит включать, когда требуются более точные графики нагрузки, быстрое срабатывание CloudWatch Alarm, автоскейлинг или когда важно собирать метрики для SLA.
- Парольный доступ к SSH в AWS по умолчанию запрещён, потому что ключи обеспечивают более высокую безопасность: приватный ключ хранится только у пользователя, исключает брутфорс и не требует передачи пароля по сети.
- Конфигурационный файл `nginx_mywebsite.conf` описывает виртуальный хост: слушает порт 80, указывает корневую директорию `/usr/share/nginx/html`, разрешает обработку PHP через сокет PHP-FPM и запрещает доступ к скрытым файлам.
- Команда `Stop` выключает виртуальную машину, сохраняя диск и все настройки для последующего запуска. `Terminate` полностью удаляет инстанс и освобождает связанные ресурсы; восстановить его уже нельзя.

## Как запустить сайт локально
```bash
cd lab02/public
php -S localhost:8000
```
После запуска сайт будет доступен по адресу `http://localhost:8000`.

## Выводы
В ходе лабораторной работы я прошёл полный цикл подготовки инфраструктуры в AWS: создал учетные записи, настроил бюджет, развернул и сконфигурировал EC2-инстанс, подключился к нему по SSH, настроил Nginx + PHP-FPM и опубликовал собственное приложение. Дополнительно закрепил навыки диагностики через журналы и мониторинг, а также научился корректно останавливать ресурсы.

## Использованные источники
- Официальная документация AWS: https://docs.aws.amazon.com/
- Руководство по Amazon Linux 2023: https://docs.aws.amazon.com/linux/
- Документация по Nginx: https://nginx.org/en/docs/
- Документация по PHP-FPM: https://www.php.net/manual/en/install.fpm.php
